---

title: Input/Output


keywords: fastai
sidebar: home_sidebar

summary: "This module manages where downloaded data is stored via a config"
description: "This module manages where downloaded data is stored via a config"
nb_path: "00_io.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_io.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Configfile">Configfile<a class="anchor-link" href="#Configfile"> </a></h2><p>The config file for now just contains one path to the folder where all data for <code>pyciss</code> will be stored.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Config" class="doc_header"><code>class</code> <code>Config</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L17" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Config</code>(<strong><code>other_config</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

<pre><code>Manage config stuff.

Attributes
-------
path: pathlib.Path

The key, value pairs found in the config file become attributes of thi
class after initialization.
At minimum, there should be the `archive_path` attribute for storing data
for this package.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">archive_path</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/home/maye/big_drive/planetary_data/pyciss&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <a href="/pyciss2/io.html#Config"><code>Config</code></a> object init will ask for an input path if the config file is not found or empty:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Config.not_found" class="doc_header"><code>Config.not_found</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Config.not_found</code>()</p>
</blockquote>

<pre><code>Use input to ask user for the archive_path.

The path will be stored in the config file `Class.path` (either default or as given
during init.)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To test this, we need to catch the UI <code>input()</code> call and provide a default output that would be entered as the <code>archive_path</code> into the <a href="/pyciss2/io.html#Config"><code>Config</code></a> object.</p>
<p>First, we create a random temporary file for a new config:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;/tmp/tmpcq8b_fqb&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we store the pointer to the <code>input</code> function as a backup, and patch the <code>input</code> function to return a test archive_path:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">old_input</span> <span class="o">=</span> <span class="nb">input</span>
<span class="c1"># patch input function for testing</span>
<span class="nb">input</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;/some/path&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we create a new Config object. As it has no archive path in it, the patched <code>input</code> call of <code>Class.not_found</code> will return the above test path.
In reality, the user will provide the path to the <code>input</code> prompt:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">toml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="s1">&#39;archive_path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/some/path&quot;</span>

<span class="c1">#return stored pointer to the input function:</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">old_input</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_db_root" class="doc_header"><code>get_db_root</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_db_root</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_db_root</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Path(&#39;/home/maye/big_drive/planetary_data/pyciss&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="PathManager">PathManager<a class="anchor-link" href="#PathManager"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PathManager" class="doc_header"><code>class</code> <code>PathManager</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L77" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PathManager</code>(<strong><code>img_id</code></strong>, <strong><code>savedir</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

<pre><code>Manage paths to data in database.

The `.pyciss.toml` config file determines the path to the database for ISS images.
With this class you can access the different kind of files conveniently.

Using the stored extensions dictionary, the attributes of the object listed here are created
dynamically at object initialization and when the image_id is being set.

NOTE
----
This class will read the .pyciss.toml to define the dbroot path, but
one can also call it with the savedir argument to override that.

Parameters
----------
img_id : str or pathlib.Path
    The N... or W... image identifier string of CISS images or the absolute
    path to an existing image
savedir : str or pathlib.Path
    Path to the pyciss image database. By default defined by what's found in
    the .pyciss.yaml config, but can be overridden using this parameter.

Attributes
----------
basepath
img_id
calib_img
calib_label
raw_image
raw_cub
raw_label
cubepath
tif
undestriped</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="db_mapped_cubes" class="doc_header"><code>db_mapped_cubes</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L199" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>db_mapped_cubes</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="db_label_paths" class="doc_header"><code>db_label_paths</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L203" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>db_label_paths</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">print_db_stats</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Print database stats.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        Table with the found data items per type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dbroot</span> <span class="o">=</span> <span class="n">get_db_root</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database location: </span><span class="si">{</span><span class="n">dbroot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">n_ids</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbroot</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;[N,W]*&quot;</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of WACs and NACs in database: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_ids</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;These kind of data are in the database: (returning pd.DataFrame)&quot;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">PathManager</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dbroot</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span> <span class="o">+</span> <span class="n">val</span><span class="p">)))]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_db_stats</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Database location: /home/maye/big_drive/planetary_data/pyciss
Number of WACs and NACs in database: 1
These kind of data are in the database: (returning pd.DataFrame)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-44-24ec69d7027f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>print_db_stats<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-43-0c1868a02f9d&gt;</span> in <span class="ansi-cyan-fg">print_db_stats</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span>     print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;These kind of data are in the database: (returning pd.DataFrame)&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     d <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">for</span> key<span class="ansi-blue-fg">,</span> val <span class="ansi-green-fg">in</span> PathManager<span class="ansi-blue-fg">.</span>extensions<span class="ansi-blue-fg">.</span>items<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span>         d<span class="ansi-blue-fg">[</span>key<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>len<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>dbroot<span class="ansi-blue-fg">.</span>glob<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;**/*&#34;</span> <span class="ansi-blue-fg">+</span> val<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>     <span class="ansi-green-fg">return</span> pd<span class="ansi-blue-fg">.</span>DataFrame<span class="ansi-blue-fg">(</span>d<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;PathManager&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="DBManager" class="doc_header"><code>class</code> <code>DBManager</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L207" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>DBManager</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filename_from_obsid" class="doc_header"><code>filename_from_obsid</code><a href="https://github.com/michaelaye/pyciss2/tree/master/pyciss2/io.py#L215" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filename_from_obsid</code>(<strong><code>obsid</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span><span class="p">;</span> <span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

